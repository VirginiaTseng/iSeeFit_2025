best_model.pt file should be put here


curl -X POST "http://localhost:8000/api/food/predict" \
  -F "file=@/Users/virginiazheng/Downloads/testimage2.jpg" \
  -F "topk=5"

{"topk":[{"label":"steak","prob":0.5655851364135742},{"label":"baby_back_ribs","prob":0.23485177755355835},{"label":"peking_duck","prob":0.012386061251163483},{"label":"chocolate_cake","prob":0.009358623996376991},{"label":"foie_gras","prob":0.008740251883864403}]}%                                                                                                          



curl -X POST "http://localhost:8000/api/food/predict" \
  -F "file=@/Users/virginiazheng/Downloads/testimage3.png" \
  -F "topk=5"


{"topk":[{"label":"apple_pie","prob":0.8645810484886169},{"label":"bread_pudding","prob":0.01151770818978548},{"label":"lasagna","prob":0.00872804969549179},{"label":"baklava","prob":0.005564163438975811},{"label":"waffles","prob":0.0054512168280780315}]}%                                                         



# åŸºæœ¬æµ‹è¯•
curl -X POST "http://localhost:8000/predict" \
  -F "file=@/path/to/your/image.jpg" \
  -F "topk=5"

# å¸¦æ›´å¤šå‚æ•°çš„æµ‹è¯•
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@/path/to/your/image.jpg" \
  -F "topk=3"


  import requests
import json

def test_food_analysis_api():
    # API ç«¯ç‚¹
    url = "http://localhost:8000/predict"
    
    # æµ‹è¯•å›¾ç‰‡è·¯å¾„
    image_path = "/path/to/your/test_image.jpg"
    
    try:
        # å‡†å¤‡æ–‡ä»¶
        with open(image_path, 'rb') as f:
            files = {'file': f}
            data = {'topk': 5}
            
            # å‘é€è¯·æ±‚
            response = requests.post(url, files=files, data=data)
            
            if response.status_code == 200:
                result = response.json()
                print("âœ… API æµ‹è¯•æˆåŠŸ!")
                print(f"ğŸ“Š ç»“æœ: {json.dumps(result, indent=2, ensure_ascii=False)}")
            else:
                print(f"âŒ API æµ‹è¯•å¤±è´¥: {response.status_code}")
                print(f"é”™è¯¯ä¿¡æ¯: {response.text}")
                
    except FileNotFoundError:
        print("âŒ æ‰¾ä¸åˆ°æµ‹è¯•å›¾ç‰‡æ–‡ä»¶")
    except requests.exceptions.ConnectionError:
        print("âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ")
    except Exception as e:
        print(f"âŒ æµ‹è¯•å‡ºé”™: {e}")

if __name__ == "__main__":
    test_food_analysis_api()



    
    æ–¹æ³•3ï¼šä½¿ç”¨ Postman æµ‹è¯•
    è®¾ç½®è¯·æ±‚ï¼š
    æ–¹æ³•ï¼šPOST
    URLï¼šhttp://localhost:8000/predict
    è®¾ç½® Bodyï¼š
    é€‰æ‹© form-data
    æ·»åŠ å­—æ®µï¼š
    file: é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
    topk: è¾“å…¥æ•°å­—ï¼ˆå¦‚ 5ï¼‰



    æ–¹æ³•4ï¼šä½¿ç”¨ FastAPI è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£
å¯åŠ¨æœåŠ¡å™¨åï¼Œè®¿é—®ï¼š
Swagger UI: http://localhost:8000/docs
ReDoc: http://localhost:8000/redoc
åœ¨ Swagger UI ä¸­å¯ä»¥ç›´æ¥æµ‹è¯•æ¥å£ã€‚
æ–¹æ³•5ï¼šåˆ›å»ºç®€å•çš„æµ‹è¯•å®¢æˆ·ç«¯



# test_client.py
import asyncio
import aiohttp
import aiofiles

async def test_api():
    url = "http://localhost:8000/predict"
    
    async with aiohttp.ClientSession() as session:
        # å‡†å¤‡æ–‡ä»¶
        async with aiofiles.open("test_image.jpg", "rb") as f:
            data = aiohttp.FormData()
            data.add_field('file', f, filename='test_image.jpg')
            data.add_field('topk', '5')
            
            async with session.post(url, data=data) as response:
                if response.status == 200:
                    result = await response.json()
                    print("âœ… æµ‹è¯•æˆåŠŸ!")
                    print(f"ç»“æœ: {result}")
                else:
                    print(f"âŒ æµ‹è¯•å¤±è´¥: {response.status}")

# è¿è¡Œæµ‹è¯•
asyncio.run(test_api())

å¯åŠ¨æœåŠ¡å™¨
é¦–å…ˆç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š
æµ‹è¯•å›¾ç‰‡å‡†å¤‡
å‡†å¤‡ä¸€äº›æµ‹è¯•å›¾ç‰‡ï¼š
é£Ÿç‰©ç…§ç‰‡
ä¸åŒè§’åº¦çš„å›¾ç‰‡
ä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡
é¢„æœŸç»“æœ
æˆåŠŸçš„å“åº”åº”è¯¥ç±»ä¼¼ï¼š
{
  "topk": [
    {"label": "apple", "prob": 0.85},
    {"label": "banana", "prob": 0.10},
    {"label": "orange", "prob": 0.05}
  ]
}

